{{ template "header" }}
    <script>

        Mustache.tags = ["||","||"];


        function handleStatus(text,ele){

                data = $.parseJSON(text);

                if(data.payload.Devices.length>0) {
                    $("#devices").html("");
                }else{

                    return;
                }

                var response = "";

                jQuery.each(data.payload.Devices,function(index,value) {

                    //override the numerical type
                    value.Type = data.payload.Types[value.Type]

                    if (value.Active == false) {

                      //  return;
                    }


                    response = response + renderTemplate(value, "deviceRowTemplate");


                });


                if(response.length>0){

                    return response;
                }

                return '  <td colspan="5">\n' +
                    '                                               No Devices detected, please wait or manually add\n' +
                    '                                            </td>';


        }

    </script>
    <script id="deviceRowTemplate" type="x-tmpl-mustache">
                     <tr>
                      <td>||Id||</td>
                      <td>||Label||</td>
                      <td>||Ip||</td>
                      <td>||Type||</td>
                      <td>
                      ||#Active||
                            <i title="Connection to device successful" class="fas text-success fa-check-circle" ></i>
                      ||/Active||
                      ||^Active||
                            <i title="Device not found, search..." class="fas text-danger fa-minus-circle" ></i>
                      ||/Active||
                      </td>
                      <td>
                        <a  class="float-right btn btn-danger" onclick="return confirm('Are you sure you want to remove?');" title="This will force remove, but if the device is automatically detected it will be added back"  href="/deviceremove/||Id||"><i class="fas fa-exclamation-triangle" > </i> Remove</a>
                        <a class="float-right btn btn-primary mr-2" href="/deviceedit/||Id||"><i class="fas fa-edit" > </i> Edit</a>
                        <a class="float-right btn btn-success mr-2" href="/learn/||Id||"><i class="fas fa-glasses" > </i> Learn</a>
                       </td>
                     </tr>
    </script>


        <main>
            <div class="container-fluid">
                <h1 class="mt-4"><i class="fas fa-tachometer-alt"> </i> Dashboard</h1>
                <!--<ol class="breadcrumb mb-4">
                    <li class="breadcrumb-item active">Dashboard</li>
                </ol>-->

                <div class="row mt-4" >
                    <div class="col-xl-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="fas fa-server mr-1"></i>
                                Broadlink Devices
                                <a class="float-right btn btn-success" href="/deviceedit/new" ><i class="fas fa-plus-square" ></i> Add Device</a>

                            </div>
                            <div class="card-body p-0">

                                <div class="table-responsive">
                                    <table class="table table-striped" id="dataTable" width="100%" cellspacing="0">
                                        <thead class="thead-dark">
                                        <tr>
                                            <th>ID</th>
                                            <th>Label</th>
                                            <th>IP</th>
                                            <th>Type</th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody id="devices" data-callback="handleStatus" hx-get="/index.json" hx-trigger="load delay:100ms, every 5s">
                                        <tr>
                                            <td colspan="5">
                                               No Devices detected, please wait or manually add
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
{{ template "footer" }}