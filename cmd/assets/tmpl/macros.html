{{ template "header" }}
    <script>

        Mustache.tags = ["||","||"];




        function handleStatus(text,ele){

                data = $.parseJSON(text)
                var out =""
                $("#devices").html("");

                jQuery.each(data.payload.Macros,function(index,value){



                    out = out + renderTemplate(value,"macroRowTemplate")


                });

                return out;
        }

    </script>
    <script id="macroRowTemplate" type="x-tmpl-mustache">
                     <tr>
                      <td class="hidden-xs">||Id||</td>
                       <td>||Label||</td>
                         <td>
                            <a class="ml-2 mr-2 btn btn-primary float-right" href="/universal/||Id||"><i class="fas fa-calculator" > </i> macro</a>

                          <a onclick="return confirm('Are you sure you want to remove?');" title="This will force remove, but if the device is automatically detected it will be added back"  class="btn btn-danger float-right"  hx-post="macroremove/||Id||" hx-target="#devices" hx-swap="none" href="/macroremove/||Id||"><i class="fas fa-exclamation-triangle" > </i> Remove</a>
                           <a class="ml-2 mr-2 btn btn-primary float-right" href="/macro/||Id||"><i class="fas fa-edit" > </i> Edit</a>

                         </td>
                     </tr>
    </script>

        <main>
            <div class="container-fluid">
                <h1 class="mt-4"><i class="fas fa-puzzle-piece"></i> Macros</h1>
                <div class="row mt-4" >
                    <div class="col-xl-12">
                        <div class="card mb-4">
                            <div class="card-header">

                                <a class="float-right btn btn-success" href="/macro/new" ><i class="fas fa-plus-square" ></i> Add Macro</a>

                            </div>
                            <div class="card-body p-0">

                                    <div class="table-responsive dataTable-container p-1">
                                    <table class="dataTable-table table table-striped" id="dataTable" width="100%" cellspacing="0">
                                        <thead class="thead-dark">
                                        <tr>
                                            <th class="hidden-xs" >ID</th>
                                            <th>Label</th>
                                            <th>

                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody id="devices" data-callback="handleStatus" hx-get="/macros.json" hx-trigger="load delay:100ms, every 5s">

                                        </tbody>
                                    </table>
                                    </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
{{ template "footer" }}